const { Telegraf } = require('telegraf');
const bot = new Telegraf('7209885388:AAEOBty7DIXSgY_F0_05DhUntMy3jpCoPW0');  // –¢–æ–∫–µ–Ω —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞

const ADMIN_ID = '744187097';  // –¢–≤–æ–π Telegram ID

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.start((ctx) => {
  return ctx.reply('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Pick Your Hero!', {
    reply_markup: {
      inline_keyboard: [
        [{ text: 'üßæ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É', callback_data: 'order' }]
      ]
    }
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É"
bot.action('order', (ctx) => {
  return ctx.editMessageText('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:', {
    reply_markup: {
      inline_keyboard: [
        [{ text: 'üì∑ –°–∫–∏–Ω –ø–æ —Ñ–æ—Ç–æ', callback_data: 'photo' }],
        [{ text: 'üéÆ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∏–Ω', web_app: { url: 'https://telegram-mini-app-three-rho.vercel.app' } }]
      ]
    }
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
bot.on('photo', async (ctx) => {
  const user = ctx.from.username || ctx.from.first_name;  // –ü–æ–ª—É—á–∞–µ–º –Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –µ–≥–æ –∏–º—è
  const photoId = ctx.message.photo[ctx.message.photo.length - 1].file_id;  // –ë–µ—Ä—ë–º —Å–∞–º—ã–π –ª—É—á—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ

  // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é File ID
  const file = await bot.telegram.getFile(photoId);
  const fileUrl = `https://api.telegram.org/file/bot${process.env.TELEGRAM_TOKEN}/${file.file_path}`;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
  ctx.reply(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user} –æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é!`);

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –∏ –Ω–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
  bot.telegram.sendMessage(ADMIN_ID, `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user} —Å –Ω–∏–∫–æ–º @${ctx.from.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'} –ø—Ä–∏—Å–ª–∞–ª —Ñ–æ—Ç–æ. File ID: ${photoId}`);
  bot.telegram.sendPhoto(ADMIN_ID, fileUrl, { caption: `–§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${user}` });

  // –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  ctx.reply('–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ! –ú—ã –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –≤–∞—à –∑–∞–ø—Ä–æ—Å.');
});

// –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.launch();

console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω');
